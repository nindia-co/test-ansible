{
    "$schema": "@SOTI_PROD_ARTIFACTORY_BASE_URL/JsonSchema/invoke-tasks/soti.net.jsonschema.invoke-tasks.v4.json",
    "Settings":
    {
        "PowerShellGet":
        {
            "Repositories":
            {
                "SOTI PowerShellGet Repository":
                {
                    "ModuleSourceLocation": "@SOTI_PROD_ARTIFACTORY_BASE_URL/api/nuget/DevOps_PowerShell_Modules",
                    "ScriptSourceLocation": "@SOTI_PROD_ARTIFACTORY_BASE_URL/api/nuget/DevOps_PowerShell_Scripts"
                }
            }
        }
    },
    "Unpackaging":
    {
        "Packages":
        [
            {
                "Source": "$In:TelegrafService.zip",
                "Destination": "$Root:TelegrafService"
            }
        ]
    },
    "Tasks":
    [
        {
            "Title": "Install tools",
            "Tags":
            [
                "*"
            ],
            "Script":
            {
                "Name": "Install-Tools",
                "Version": "1.0.0"
            },
            "Arguments":
            {
                "ToolsDir": "$Root:Tools",
                "Tools":
                {
                    "Chocolatey":
                    {
                        "DefaultSource": "@SOTI_PROD_ARTIFACTORY_BASE_URL/api/nuget/chocolatey",
                        "Packages":
                        [
                            {
                                "Id": "awscli",
                                "Version": "1.16.105"
                            },
                            {
                                "Id": "azure-cli",
                                "Version": "2.39.0"
                            },
                            {
                                "Id": "NuGet.CommandLine",
                                "Version": "4.7.1"
                            },
                            {
                                "Id": "jfrog",
                                "Version": "1.5.1"
                            }
                        ]
                    },
                    "NuGet":
                    {
                        "DefaultSource": "@SOTI_PROD_ARTIFACTORY_BASE_URL/api/nuget/nuget",
                        "Packages":
                        [
                        ]
                    }
                }
            }
        },
        {
            "Title": "Configure AWS default profile",
            "Tags":
            [
                "AWS"
            ],
            "Script": "$In:.ci/PackagingStage/Scripts/Config-AwsCliProfile.ps1",
            "Arguments":
            {
                "AccessKey": "@AccessKey",
                "SecretKey": "@SecretKey",
                "Region": "@Region",
                "Output": "json"
            }
        },
        {
            "Title": "Save PowerShellGet scripts",
            "Tags":
            [
                "*"
            ],
            "Script": "$In:.ci/PackagingStage/Scripts/Save-PowerShellGetScripts.ps1",
            "Arguments":
            {
                "Source": "$In:.ci/.CloudFiles",
                "Destination": "$In:.ci/.CloudFiles",
                "ExtraScripts":
                [
                ]
            }
        },
        {
            "Title": "Copy TelegrafService files",
            "Tags":
            [
                "*"
            ],
            "Script":
            {
                "Name": "Transfer-FileSystemItems",
                "Version": "1.0.0"
            },
            "Arguments":
            {
                "Items":
                [
                    "$In:.ci/.CloudFiles/TelegrafService/*.*"
                ],
                "DestinationDirectory": "$Root:TelegrafService/telegraf"
            }
        },
        {
            "Title": "Copy install packages",
            "Tags":
            [
                "*"
            ],
            "Script":
            {
                "Name": "Transfer-FileSystemItems",
                "Version": "1.0.0"
            },
            "Arguments":
            {
                "Items":
                [
                    "$In:*.msi",
                    "$In:*.exe"
                ],
                "DestinationDirectory": "$Root:Install"
            }
        },
        {
            "Title": "Download Chocolatey packages",
            "Tags":
            [
                "*"
            ],
            "Script": "$In:.ci/PackagingStage/Scripts/Download-ChocolateyPackages.ps1",
            "Arguments":
            {
                "DefaultSource": "@SOTI_PROD_ARTIFACTORY_BASE_URL/api/nuget/chocolatey",
                "DownloadDirectory": "$Root:ChocolateyPackages",
                "Packages":
                [
                    {
                        "Id": "@ApnsChocolateyPackageId",
                        "Version": "2.0.2"
                    },
                    {
                        "Id": "apache-jmeter-soti-customized",
                        "Version": "@JMeterVersion"
                    },
                    {
                        "Id": "Soti.Simulation.IosConsoleRunner",
                        "Version": "@IosConsoleRunnerVersion"
                    }
                ]
            }
        },
        {
            "Title": "Extract Agent Simulator",
            "Tags":
            [
                "*"
            ],
            "Script": "$In:.ci/PackagingStage/Scripts/Extract-AgentSimulator.ps1",
            "Arguments":
            {
                "SourceArchiveFilePath": "$In:NewSimulator.zip",
                "FileNameWildcard": "Simulator.exe",
                "DestinationDirectory": "$Root:AgentSimulator"
            }
        },
        {
            "Title": "Upload performance testing pre-requisite files",
            "Tags":
            [
                "*"
            ],
            "Script": "$In:.ci/PackagingStage/Scripts/Upload-PerformanceTestsFiles.ps1",
            "Arguments":
            {
                "InfrastructureType": "@InfrastructureType",
                "Pipeline": "@Pipeline",
                "Bucket": "@Bucket",
                "Region": "@Region",
                "AccessKey": "@AccessKey",
                "SecretKey": "@SecretKey",
                "ArtifactoryUrl": "@ArtifactoryUrl",
                "ArtifactoryRepository": "@ArtifactoryRepository",
                "ArtifactoryAccessToken": "@ArtifactoryAccessToken",
                "ClientId": "@ClientId",
                "ClientSecret": "@ClientSecret",
                "TenantId": "@TenantId",
                "SubscriptionId": "@SubscriptionId",
                "ResourceGroup": "@ResourceGroup",
                "StorageAccountName": "@StorageAccountName",
                "ContainerName": "@ContainerName",
                "StandardBlobTier": "@StandardBlobTier",
                "PackageFileName": "@PackageFileName",
                "OutputConfigurationFilePath": "@OutputConfigurationFilePath",
                "SourceItems":
                [
                    "$In:Setup",
                    "$In:MockSotiService.zip",
                    "$In:WindowsModernPackage.zip",
                    "$Root:ChocolateyPackages",
                    "$Root:AgentSimulator",
                    "$Root:TelegrafService",
                    "$Root:Install",
                    "$In:.ci/.CloudFiles",
                    "$In:.ci/.Common",
                    "$In:.ci/PackagingStage/Misc/License.encrypted.bin",
                    "$In:.ci/PackagingStage/Misc/3535C27522384A90EADFFFA8DA952F0C607D6073.pfx",
                    "$In:.ci/TestExecutionStage/TracelogDB_Scripts",
                    "$In:.ci/SetupStage/Misc/FreshInstallTemplate.json"
                ]
            }
        }
    ],
    "OnFailureTasks":
    [
    ],
    "Packaging":
    {
        "Packages":
        [
        ]
    }
}
